<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/default_layout}">
   <div layout:fragment="content" id="layout">
<head>
<!-- csrf 설정 -->
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>

<meta charset="UTF-8">
<style>
#customers {
  font-family: Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  margin: 0 auto;
}

#customers td, #customers th {
  border: 1px solid #ddd;
  padding: 8px;
}

#customers th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
}
/* The container */
.container {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 12px;
  cursor: pointer;
  font-size: 22px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default radio button */
.container input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 25px;
  width: 25px;
  background-color: #eee;
  border-radius: 50%;
}

/* On mouse-over, add a grey background color */
.container:hover input ~ .checkmark {
  background-color: #ccc;
}

/* When the radio button is checked, add a blue background */
.container input:checked ~ .checkmark {
  background-color: #2196F3;
}

/* Create the indicator (the dot/circle - hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the indicator (dot/circle) when checked */
.container input:checked ~ .checkmark:after {
  display: block;
}

/* Style the indicator (dot/circle) */
.container .checkmark:after {
 	top: 9px;
	left: 9px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: white;
}
h1 {

  text-align: center;
}
#p {
	color: red;
}
.hidden {
  display: none;
}
.etcVal {
	margin-left: 20px;
}
#bodyContents {
  height: auto;
  width: 800px;
  margin: 50px auto;
  border: 1px solid #ccc;
  overflow: hidden;
}
/* 상태바 */
.progressbar{
  width: 400px;
  height: 15px;
  border-radius: 10px;
  overflow:hidden;
  background: #ccc;
  position:relative;
  margin: 10px auto;
}
.progressbar::after{
  content:'';
  position:absolute;
  top:0;
  left:0;
  height: 15px;
  width:0;
  background:blue;
  animation: progress 2s ease forwards;
}
@keyframes progress{
  0%{width: 0px}
  100%{width: 14%;}
}
.progress{
  position: absolute;
  top:0;
  right:0;
  z-index:99;
}
.progress::after{
  content: '%';
  
}
</style>
</head>
<body>
 <section class="module bg-dark-60 gallery-page-header parallax-bg" data-background="/assets/images/gallery_bg.jpg" style="background-image: url(&quot;assets/images/gallery_bg.jpg&quot;);">
          <div class="container">
            <div class="row">
              <div class="col-sm-6 col-sm-offset-3">
                <h2 class="module-title font-alt">Big Title</h2>
                <div class="module-subtitle font-serif">Small Title</div>
              </div>
            </div>
          </div>
        </section>
 <!-- 행사유형 선택 -->
 <form id="insertFrm" name="insertFrm">
<div id="bodyContents">
<div class="progressbar">
<!--   <span class="progress">0</span> -->
</div>
<h1>어떤 행사를 기획중이신가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">기념식
  <input type="radio" name="eventType" value="기념식">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">축제/가요제/플리마켓
  <input type="radio" name="eventType" value="축제/가요제/플리마켓">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">체육대회/단합행사
  <input type="radio" name="eventType" value="체육대회/단합행사">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">세미나/포럼/워크샵
  <input type="radio" name="eventType" value="세미나/포럼/워크샵">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">전시회/박람회
  <input type="radio" name="eventType" value="전시회/박람회">
  <span class="checkmark"></span>
</label></td>
  </tr>
    <tr>
   <td><label class="container">신년회/송년회
  <input type="radio" name="eventType" value="신년회/송년회">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
   <input type="button" value="다음" class="next" id="eventType">
</div><!-- end of bodyContents -->

 <!-- 행사장소 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 예정 장소는 어디인가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">호텔
  <input type="radio"  name="expectedPl" value="호텔">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">이벤트/컨벤션홀
  <input type="radio"  name="expectedPl" value="이벤트/컨벤션홀">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">주거 공간(주택,빌라 등)
  <input type="radio"  name="expectedPl" value="주거 공간">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">사내 공간(강당, 사무실, 로비 등)
  <input type="radio"  name="expectedPl" value="사내 공간">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">기타 실내(극장, 공연장, 클럽 등)
  <input type="radio"  name="expectedPl" value="기타 실내">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">기타 야외(체육관, 공원, 캠핌장 등)
  <input type="radio"  name="expectedPl" value="기타 야외">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">미정
   <input type="radio" name="expectedPl" value="미정">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td class="etc"><label class="container" >기타
  <input type="radio" name="expectedPl" id="expectedPlEtc">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="expectedPl">
</div><!-- end of bodyContents -->

 <!-- 행사규모 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 규모는 어느정도인가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">30명 미만
  <input type="radio" name="pats" value="30">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">50명 미만
  <input type="radio" name="pats" value="50">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">100명 미만
  <input type="radio" name="pats" value="100">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">200명 미만
  <input type="radio" name="pats" value="200">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">300명 미만
  <input type="radio" name="pats" value="300">
  <span class="checkmark"></span>
</label></td>
  </tr>
    <tr class="etc">
   <td><label class="container">400명 이상
  <input type="radio" name="pats" value="400">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="pats">
</div><!-- end of bodyContents -->

 <!-- 행사날짜 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 날짜를 선택해주세요.</h1>
<input type="date" name="eventDate" value=""><br>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" id="eventDate" class="next">
</div><!-- end of bodyContents -->

 <!-- 행사시작시간 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 시작 시간은 언제인가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">오전
  <input type="radio"  name="eventTime" value="am">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">오후
  <input type="radio"  name="eventTime" value="pm">
  <span class="checkmark"></span>
</label></td>
  <!-- </tr>
  <tr>
   <td><label class="container">시간</label>
  <input name="time"></td>
  </tr> -->
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="eventTime">
</div><!-- end of bodyContents -->

 <!-- 행사소요시간 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 예상 소요시간을 선택해주세요</h1>
<table id="customers">
  <tr>
    <td><label class="container">1시간
  <input type="radio"  name="eventDuration" value="1">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">2시간
  <input type="radio"  name="eventDuration" value="2">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">3시간
  <input type="radio"  name="eventDuration" value="3">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">4시간
  <input type="radio"  name="eventDuration" value="4">
  <span class="checkmark"></span>
</label></td>
  </tr>
   <tr>
   <td><label class="container">하루 이상
  <input type="radio"  name="eventDuration" value="24">
  <span class="checkmark"></span>
</label></td>
  </tr>
   <tr>
   <td><label class="container">기타
  <input type="radio"  name="eventDuration" class="etc" id="eventDurationEtc">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="eventDuration">
 </div><!-- end of bodyContents -->
 
  <!-- 행사지역 선택 -->
 <div id="bodyContents" class="hidden">
<h1>행사 예상 지역을 선택해주세요.</h1>
<select name="expectedLocal" >
	<option value="A00">==지역선택==</option>
	<option value="A01">서울</option>
	<option value="A02">인천</option>
	<option value="A03">대구</option>
	<option value="A04">광주</option>
	<option value="A05">대전</option>
	<option value="A06">울산</option>
	<option value="A07">부산</option>
	<option value="A08">경기도</option>
	<option value="A09">강원도</option>
	<option value="A10">충청도</option>
	<option value="A11">전라도</option>
	<option value="A12">경상도</option>
	<option value="A13">제주도</option>
</select>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="expectedLocal">
</div><!-- end of bodyContents -->

 <!-- 행사 희망사항 입력 -->
<div id="bodyContents" class="hidden">
<h1>행사 관련 희망사항을 알려주세요.</h1>
<input name="wishes" placeholder="행사 내용 및 콘셉트 등애 대해 남겨주세요"><br>
 <input type="button" value="이전" class="prev">
 
 <!-- 비회원 로그인창 띄우기 -->
 <th:block sec:authorize="!isAuthenticated()">			
 <input type="button" value="견적서 보내기" class="submit" onclick="login()">
 </th:block>
<!-- 로그인 회원 버튼표시 -->
<th:block sec:authorize="isAuthenticated()">
<input type="button" value="견적서 보내기" class="submit">
</th:block> 
<!--  <input type="hidden" th:value="${session.member.userId}" name="userId" />  -->
</div>
<input type="hidden" id="token" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
</form>
<script>
//페이지 벗어나기전 알림
 var checkUnload = true;
 $(window).on("beforeunload", function(){
	 if(checkUnload) return "이 페이지를 벗어나면 작성된 내용은 저장되지 않습니다.";
});

//기타 입력값 radio value에 입력
$('body').on('change','[id$="etcVal"]', function() {
	$(this).closest('td').find('[type="radio"]').val($(this).val())
})
//기타 체크시 텍스트박스 생성
$('input:radio').click(function() {
	
	var name =$(this).attr('name')
	
	if($('#'+name+'Etc').is(":checked")) {
		$('#'+name+'etcVal').remove()
		var input = document.createElement('input');
		input.setAttribute('id', name+'etcVal')
		//input.setAttribute('name', name+'etcVal')
		
		$(this).parent().parent().append(input)
	} else {
		$('#'+name+'etcVal').remove()
	} 
	});
	
//다음 버튼 클릭 시
$('.next').click(function() {
	var name = $(this).attr('id');
	//console.log(!$('input:radio[id='+name+'etcVal]').val())
	
	//선택항목 별 선택여부 체크
	switch(name){
	case "eventType" :
	case "expectedPl" :
	case "pats" : 
	case "eventTime" :
	case "eventDuration" :
		var checked = $('input:radio[name='+name+']:checked');
		if(!checked.length) {
		$('p').remove()
		 var p = document.createElement('p')
		 p.setAttribute('id', 'p')
		 p.textContent = '옵션을 선택해주세요.';
		 $(this).parent().append(p)
		 return false;
		}
			$(this).parent().attr('class','hidden')
			$(this).parent().next().removeClass('hidden');
		break;
		
	case "expectedLocal" :
		if($("[name=expectedLocal] > option:selected").val() == 'A00'){
			$('p').remove()
			 var p = document.createElement('p')
			 p.setAttribute('id', 'p')
			 p.textContent = '옵션을 선택해주세요.';
			 $(this).parent().append(p)
		      return false;
			}
			$(this).parent().attr('class','hidden')
			$(this).parent().next().removeClass('hidden');
		break;
		
	case "eventDate" :
		var date = $('input[name=eventDate]').val();
		if(date == "") {
			$('p').remove()
			 var p = document.createElement('p')
			 p.setAttribute('id', 'p')
			 p.textContent = '옵션을 선택해주세요.';
			 $(this).parent().append(p)
		      return false;
		}
		$(this).parent().attr('class','hidden')
		$(this).parent().next().removeClass('hidden');
		break;
	}
});

//이전 버튼 클릭 시 
$('.prev').click(function() {
	  $('p').remove()
	  $(this).parent().attr('class','hidden')
	  $(this).parent().prev().removeClass('hidden');
	});
	
//오늘 이전날짜 선택불가
var now_utc = Date.now()
var timeOff = new Date().getTimezoneOffset()*60000;
var today = new Date(now_utc-timeOff).toISOString().split("T")[0];
document.getElementById('eventDate').setAttribute("min", today);

//견적서 보내기 버튼 클릭 시
$('.submit').click(function() {
	checkUnload = false; //페이지 벗어날 때 alert 제한
	//csrf 
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
	
	var data = $("form[name=insertFrm]").serializeObject();
  	//견적요청서 등록
 	$.ajax({
		url: "/insertEst",
		method: "POST",
		contentType: 'application/json',
		data: JSON.stringify(data),
		beforeSend : function(xhr)
        {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
        xhr.setRequestHeader(header, token);
        },
		success: function (data) {
			console.log(data)
			location.href="/estFormDone?eno=" + data;
         },
         error: function () {
				alert("서버 요청 실패");
			}
    });
	});
//비회원 로그인창 띄우기
function login(){
	 $("#header_modal").show();
}

//상태바
$({ val : 0 }).animate({ val : 30 }, {
   duration: 5000,
  step: function() {
    $(".progress").text(Math.floor(this.val));
  } ,
  complete: function() {
    $(".progress").text(Math.floor(this.val));
    $(".progress").css("color","#fff");
  } 
});
</script>
</div>
</body>
</html>