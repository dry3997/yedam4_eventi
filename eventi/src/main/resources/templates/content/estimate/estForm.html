<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/default_layout}">
<head>
<!-- csrf 설정 -->
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>

<meta charset="UTF-8">
<style>
#customers {
  font-family: Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 50%;
  margin: 0 auto;
}

#customers td, #customers th {
  border: 1px solid #ddd;
  padding: 8px;
}

#customers th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
}
/* The container */
.container {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 12px;
  cursor: pointer;
  font-size: 22px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default radio button */
.container input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 25px;
  width: 25px;
  background-color: #eee;
  border-radius: 50%;
}

/* On mouse-over, add a grey background color */
.container:hover input ~ .checkmark {
  background-color: #ccc;
}

/* When the radio button is checked, add a blue background */
.container input:checked ~ .checkmark {
  background-color: #2196F3;
}

/* Create the indicator (the dot/circle - hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the indicator (dot/circle) when checked */
.container input:checked ~ .checkmark:after {
  display: block;
}

/* Style the indicator (dot/circle) */
.container .checkmark:after {
 	top: 9px;
	left: 9px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: white;
}
h1 {
  text-align: center;
}
p {
	color: red;
}
.hidden {
  display: none;
}
.etcVal {
	margin-left: 20px;
}
#bodyContents {
  background-color: white;
  height: auto;
  width: 800px;
  margin: 10px auto;
  border: 1px solid #ccc
}
</style>
</head>
<body>
<div layout:fragment="content" id="layout">
   <section class="hero-wrap hero-wrap-2"
      style="background-image: url(&quot;images/bg_2.jpg&quot;); background-position: 50% 0%;"
      data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
         <div
            class="row no-gutters slider-text align-items-end justify-content-center">
            <div
               class="col-md-9 ftco-animate mb-5 text-center fadeInUp ftco-animated">
               <h2 class="mb-0 bread">견적서 작성요청</h2>
            </div>
         </div>
      </div>
   </section>
 <!-- 행사유형 선택 -->
 <form id="insertFrm" name="insertFrm">
<div id="bodyContents">
<h1>어떤 행사를 기획중이신가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">기념식
  <input type="radio" name="eventType" value="기념식">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">축제/가요제/플리마켓
  <input type="radio" name="eventType" value="축제/가요제/플리마켓">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">체육대회/단합행사
  <input type="radio" name="eventType" value="체육대회/단합행사">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">세미나/포럼/워크샵
  <input type="radio" name="eventType" value="세미나/포럼/워크샵">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">전시회/박람회
  <input type="radio" name="eventType" value="전시회/박람회">
  <span class="checkmark"></span>
</label></td>
  </tr>
    <tr>
   <td><label class="container">신년회/송년회
  <input type="radio" name="eventType" value="신년회/송년회">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
   <input type="button" value="다음" class="next" id="eventType">
</div><!-- end of bodyContents -->

 <!-- 행사장소 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 예정 장소는 어디인가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">호텔
  <input type="radio"  name="expectedPl" value="호텔">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">이벤트/컨벤션홀
  <input type="radio"  name="expectedPl" value="이벤트/컨벤션홀">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">주거 공간(주택,빌라 등)
  <input type="radio"  name="expectedPl" value="주거 공간">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">사내 공간(강당, 사무실, 로비 등)
  <input type="radio"  name="expectedPl" value="사내 공간">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">기타 실내(극장, 공연장, 클럽 등)
  <input type="radio"  name="expectedPl" value="기타 실내">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">기타 야외(체육관, 공원, 캠핌장 등)
  <input type="radio"  name="expectedPl" value="기타 야외">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">미정
   <input type="radio" name="expectedPl" value="미정">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td class="etc"><label class="container" >기타
  <input type="radio" name="etc">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="expectedPl">
</div><!-- end of bodyContents -->

 <!-- 행사규모 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 규모는 어느정도인가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">30명 미만
  <input type="radio" name="pats" value="30">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">50명 미만
  <input type="radio" name="pats" value="50">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">100명 미만
  <input type="radio" name="pats" value="100">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">200명 미만
  <input type="radio" name="pats" value="200">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">300명 미만
  <input type="radio" name="pats" value="300">
  <span class="checkmark"></span>
</label></td>
  </tr>
    <tr class="etc">
   <td><label class="container">기타
  <input type="radio" name="patsEtc">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="pats">
</div><!-- end of bodyContents -->

 <!-- 행사날짜 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 날짜를 선택해주세요.</h1>
<input type="date" name="eventDate" id="eventDate" value=""><br>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" id="eventDate" class="next">
</div><!-- end of bodyContents -->

 <!-- 행사시작시간 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 시작 시간은 언제인가요?</h1>
<table id="customers">
  <tr>
    <td><label class="container">오전
  <input type="radio"  name="eventTime" value="am">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">오후
  <input type="radio"  name="eventTime" value="pm">
  <span class="checkmark"></span>
</label></td>
  <!-- </tr>
  <tr>
   <td><label class="container">시간</label>
  <input name="time"></td>
  </tr> -->
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="eventTime">
</div><!-- end of bodyContents -->

 <!-- 행사소요시간 선택 -->
<div id="bodyContents" class="hidden">
<h1>행사 예상 소요시간을 선택해주세요</h1>
<table id="customers">
  <tr>
    <td><label class="container">1시간
  <input type="radio"  name="eventDuration" value="1">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">2시간
  <input type="radio"  name="eventDuration" value="2">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">3시간
  <input type="radio"  name="eventDuration" value="3">
  <span class="checkmark"></span>
</label></td>
  </tr>
  <tr>
   <td><label class="container">4시간
  <input type="radio"  name="eventDuration" value="4">
  <span class="checkmark"></span>
</label></td>
  </tr>
   <tr>
   <td><label class="container">하루 이상
  <input type="radio"  name="eventDuration" value="24">
  <span class="checkmark"></span>
</label></td>
  </tr>
   <tr>
   <td><label class="container">기타
  <input type="radio"  name="durationEtc" class="etc">
  <span class="checkmark"></span>
</label></td>
  </tr>
</table>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="eventDuration">
 </div><!-- end of bodyContents -->
 
  <!-- 행사지역 선택 -->
 <div id="bodyContents" class="hidden">
<h1>행사 예상 지역을 선택해주세요.</h1>
<select name="expectedLocal" >
	<option value="A00">==지역선택==</option>
	<option value="A01">서울</option>
	<option value="A02">인천</option>
	<option value="A03">대구</option>
	<option value="A04">광주</option>
	<option value="A05">대전</option>
	<option value="A06">울산</option>
	<option value="A07">부산</option>
	<option value="A08">경기도</option>
	<option value="A09">강원도</option>
	<option value="A10">충청도</option>
	<option value="A11">전라도</option>
	<option value="A12">경상도</option>
	<option value="A13">제주도</option>
</select>
 <input type="button" value="이전" class="prev">
 <input type="button" value="다음" class="next" id="expectedLocal">
</div><!-- end of bodyContents -->

 <!-- 행사 희망사항 입력 -->
<div id="bodyContents" class="hidden">
<h1>행사 관련 희망사항을 알려주세요.</h1>
<input name="wishes" placeholder="행사 내용 및 콘셉트 등애 대해 남겨주세요"><br>
 <input type="button" value="이전" class="prev">
 <input type="button" value="견적서 보내기" class="submit">
 <input type="hidden" th:value="${session.member.userId}" name="userId" /> 
</div>
<input type="hidden" id="token" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
</form>
<script>
//다음 버튼 클릭 시
$('.next').click(function() {
	var name = $(this).attr('id');
	//선택항목 별 선택여부 체크
	switch(name){
	case "eventType" :
	case "expectedPl" :
	case "pats" : 
	case "eventTime" :
	case "eventDuration" :
		var checked = $('input[name='+name+']:checked');
		if(!checked.length) {
		$('p').remove()
		 var p = document.createElement('p')
		 p.setAttribute('id', 'p')
		 p.textContent = '옵션을 선택해주세요.';
		 $(this).parent().append(p)
		 return false;
		}
			$(this).parent().attr('class','hidden')
			$(this).parent().next().removeClass('hidden');
		break;
		
	case "expectedLocal" :
		if($("[name=expectedLocal] > option:selected").val() == 'A00'){
			$('p').remove()
			 var p = document.createElement('p')
			 p.setAttribute('id', 'p')
			 p.textContent = '옵션을 선택해주세요.';
			 $(this).parent().append(p)
		      return false;
			}
			$(this).parent().attr('class','hidden')
			$(this).parent().next().removeClass('hidden');
		break;
		
	case "eventDate" :
		var date = $('input[name=eventDate]').val();
		if(date == "") {
			$('p').remove()
			 var p = document.createElement('p')
			 p.setAttribute('id', 'p')
			 p.textContent = '옵션을 선택해주세요.';
			 $(this).parent().append(p)
		      return false;
		}
		$(this).parent().attr('class','hidden')
		$(this).parent().next().removeClass('hidden');
		break;
	}
});

//이전 버튼 클릭 시 
$('.prev').click(function() {
	  $('p').remove()
	  $(this).parent().attr('class','hidden')
	  $(this).parent().prev().removeClass('hidden');
	});
	
//오늘 이전날짜 선택불가
var now_utc = Date.now()
var timeOff = new Date().getTimezoneOffset()*60000;
var today = new Date(now_utc-timeOff).toISOString().split("T")[0];
document.getElementById('eventDate').setAttribute("min", today);

//기타 체크시
$('input:radio[name=etc]').click(function() { 
	var text = document.createElement('<input name="etcVal" placeholder="직접 입력"/>')
	$(this).parent().parent().append(text)
	});
	
//견적서 보내기 버튼 클릭 시
$('.submit').click(function() {
	
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");

	var data = $("form[name=insertFrm]").serializeObject();
	console.log(data);
	//견적요청서 등록
 	$.ajax({
		url: "/insertEst",
		method: "POST",
		contentType: 'application/json',
		data: JSON.stringify(data),
		beforeSend : function(xhr)
        {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
        xhr.setRequestHeader(header, token);
        },
		success: function (data) {
			console.log(data);
			//location.href="/estFormDone?eno=" + data;
         },
         error: function () {
				alert("서버 요청 실패");
			}
    });
	}); 
</script>
</div>
</body>
</html>