<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/default_layout}"
   xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
   
<head>
	<link rel="stylesheet" href="/css/contest/button.css">
	<link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="detail.css" />
	 <!-- 구글 폰트 아이콘 -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

<style>
.modal {
	display: none;
	position: fixed;
	top: 25em;
	left: 0; width : 100%;
	height: 100%;
	z-index: 1;
	width: 100%;
	
}

.modal h2 {
	margin: 0;
}

.modal button {
	display: inline-block;
	width: 100px;
	border: 0.2px solid black;
	border-radius:5px;
}

.modal .modal_content {
	width: 350px;
    min-height: 200px;
	margin: 0 auto;
	padding: 20px;
	background: #fff;
	border: 0.5px solid #666;
    border-radius: 15px;
}

.modal .modal_layer {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.5);
	z-index: -1;
}


.modal_login_btn{
	background:#2fb380;
}
.button_box{
	display:flex;
	margin-top: 40px;
	justify-content: flex-end;

}

.heart {
  width: 100px;
  height: 100px;
  background: url("https://cssanimation.rocks/images/posts/steps/heart.png") no-repeat;
  background-position: 0 0;
  cursor: pointer;
  transition: background-position 1s steps(28);
  transition-duration: 0s;
  }
  
  .active {
    transition-duration: 1s;
    background-position: -2800px 0;
  }

/* 레이아웃 */
.detail-header,.tabs,.detail-main {
    width: 1000px;
    margin: 60px auto;
}
.section {
    padding: 32px;
}
.sub-title {
    font-size: 20px;
    margin-bottom: 24px;
    font-weight:700;
}
.list > li {
    margin: 14px 0;
}
.list > li > label {
    display: inline-block;
    width: 80px;
    color: var(--main-yellow);
}

/* 상단 영역 */
.detail-header {
    border: 3px solid #FFDE59;
    border-radius: 20px;
    box-shadow: 4px 10px 20px grey;
}

/* 제목 영역 */
.title-area {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--light-gray);
}
.title-wrap {
    width: 75%;
    border-right: 1px solid var(--light-gray);
}
.title-wrap > h3 {
    margin-bottom: 4px;
    font-size: 14px;
}
.title-wrap > h1 {
    font-weight: bold;
    font-size: 28px;
}
.company-image-wrap {
    width: 200px;
    height: 100px;
    overflow: hidden;
}
.company-image-wrap > img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* 아이콘 영역 */
.icon-wrap {
    display: flex;
    justify-content: space-evenly;
}
.icon-wrap > li {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.icon-wrap > li > i {
    margin-bottom: 10px;
    padding: 16px;
    border: 1px solid var(--main-yellow);
    border-radius: 50%;
    color: var(--main-yellow);
}
.icon-wrap > li > span {
    font-size: 14px;
}

/* 탭 메뉴 */
.tabs {
    display: flex;
    justify-content: space-evenly;
}
.tab {
    width: 100%;
    padding: 16px;
    text-align: center;
    font-size: 18px;
    cursor: pointer;
    border: 1px solid var(--light-gray);
}
.tab:nth-of-type(2) {
    border-left: none;
    border-right: none;
}
.tab:first-of-type {
    border: 1px solid var(--main-yellow);
    color: var(--main-yellow);
    font-weight: bold;
}

/* 상세 영역 */
.detail-section {
    padding: 60px 0; 
    border-bottom: 1px solid var(--light-gray);
}
.detail-section:first-of-type {
    padding-top: 0;
}
.detail-image-wrap {
    text-align: center;
}

/* 조건 영역 레이아웃 */
.summary-area,
.recruitment-condition-area {
    border-bottom: 1px solid var(--light-gray);
}
.header-detail-layout {
    display: flex;
}
.header-detail-layout > .left {
    width: 700px;
    border-right: 1px solid var(--light-gray);
}
.header-detail-layout > .right {
    width: 300px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

/* 지원 버튼 영역 */
.apply-button-wrap {
    padding: 0 32px;
    text-align: center;
}
.apply-button-wrap > button {
    width: 100%;
    height: 50px;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
}
.apply-button-wrap > button:first-of-type {
    margin-bottom: 8px;
    border: none;
    background-color: var(--main-yellow);
    color: #fff;
}
.apply-button-wrap > button:last-of-type {
    border: 1px solid var(--main-yellow);
    background-color: #fff;
    color: var(--main-yellow);
}

/* 채용기업정보 */
.detail-section > .company-image-wrap {
    float: left;
}
.detail-section > .list {
    margin-left: 200px;
    padding-left: 32px;
    border-left: 1px solid var(--light-gray);
}
.option-area,
.card-area {
    padding: 0 16px;
}
.filtering-area {
    margin-bottom: 16px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--light-gray);
}

/* 메뉴 영역*/
.content-wrap {
    width: 1400px;
    margin: 60px auto 0;
}
.option-area,
.card-area {
    padding: 0 16px;
}
.filtering-area {
    margin-bottom: 16px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--light-gray);
}

/* 검색, 버튼 영역 */
.search-area {
	display: flex;
    gap: 6px;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: flex-end;
    padding: 10px;
}
.button {
    display: inline-block;
    height: 40px;
    border-radius: 3px;
    margin: 0;
}
.button {
    cursor: pointer;
}
.user-search-button {
    background: #fff;
    border: 1px solid var(--light-gray);
}
.post-button {
    background: var(--main-color);
    border: none;
    color: #fff;
}
@import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/static/pretendard-dynamic-subset.css");

:root {
	--main-color: #FAB955;
	--light-gray: #dbdbdb;
}
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video,
textarea {
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 100%;
	font: inherit;
	vertical-align: baseline;
	box-sizing: border-box;
}
a {
	color: inherit;
	text-decoration: none;
}

/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
	display: block;
}
body * {
	font-family: 'Pretendard';
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}
ol, ul, li {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}
#iconSection{
	display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    align-items: center;
}

#iconView{
	display: flex;
    align-items: center;
    margin-right: 20px;
}

.btn-warning {
    font-weight: 700;
    font-size: 26px;
    color: #000;
    width: 80%;
    height: 66%;
    background-color: #FAB955;
    border-color: #FAB955;
}
}
/* 검색, 버튼 영역 끝 */
</style>
</head>
<body>
<div layout:fragment="content">

<section id="picture "class="module bg-dark-60 gallery-page-header parallax-bg" data-background="/images/job.jpeg" style="background-image: url(&quot;assets/images/job.jpeg&quot;); background-size: 100%;">
          <div class="container">
            <div class="row">
              <div class="col-sm-6 col-sm-offset-3">
                <h2 class="module-title font-alt" style="margin: 0;">상세게시판</h2>
              </div>
            </div>
          </div>
</section>



	<div class="content-wrap">
	
        <!-- 상단 영억 -->
        <div class="detail-header">
            <div class="section summary-area">
                <!-- 제목 영역 -->
                <div class="title-area">
                    <div class="title-wrap">
	                   
		                 <h1 th:text=${job.title}>이벤트 행사 단기 스텝 채용합니다</h1>
                    </div>
                    <div class="company-image-wrap">
                    	<!-- 버튼 영역 -->

			            	<button type="button" class="btn btn-warning" th:onclick="|location.href='@{ApplyForm(jobNo=${job.jobNo})}'|">구직신청</button>

                    </div>
                </div>

                <!-- 아이콘 영역 -->
                <div class="icon-wrap">
		              <div class="col-sm-6 col-md-3 col-lg-3">
		                <div class="count-item mb-sm-40">
		                  <div class="count-icon"><span class="icon-wallet"></span></div>
		                  	<h3 class="count-to font-alt" th:data-countto="${job.pay}" th:text="${job.pay}"></h3>
		                  	<h5 class="count-title font-serif">수당</h5>
		                </div>
		              </div>
		              
                        <div class="col-sm-6 col-md-3 col-lg-3">
			                <div class="count-item mb-sm-40">
			                  <div class="count-icon"><span class="icon-profile-male"></span></div>
			                  	<h3 class="count-to font-alt" th:data-countto="${job.reCount}" th:text="${job.reCount}"></h3>
			                  	<h5 class="count-title font-serif">지원자수</h5>
			                </div>
		              </div>
		              
                        <div class="col-sm-6 col-md-3 col-lg-3">
			                <div class="count-item mb-sm-40">
			                  <div class="count-icon"><span class="icon-calendar"></span></div>
			                   <th:block th:if="${job.remain > 0}">
			                  	<h3 class="count-to font-alt" th:data-countto="${job.remain}" th:text="|${job.remain} 일전|"></h3>
			                  </th:block>
			                  <th:block th:unless="${job.remain > 0} ">
								<h3 style="color:red" th:text="마감"></h3>
							</th:block>
			                  <h5 class="count-title font-serif">마감일</h5>
			                </div>
		              </div>
                   
                       <div class="col-sm-6 col-md-3 col-lg-3">
		                <div class="count-item mb-sm-40">
			            	<div class="count-icon"><span class="icon-heart"></span></div>
			                  <h3 class="count-to font-alt" th:data-countto="${job.cnt}"  th:text=${job.cnt}></h3>
			                 <h5 class="count-title font-serif">좋아요수</h5>
		                </div>
		              </div>
                    
                </div>
            </div>

            <div class="header-detail-layout">
                <div class="left">
                    <!-- 모집조건 섹션 -->
                    <div class="section recruitment-condition-area">
                        <h2 class="sub-title">모집조건</h2>
                        <ul class="list">
                            <li>
                                <label>내용</label>
                                <span th:utext=${job.jobCntn}>2023.02.07</span>
                            </li>
                            <li>
                                <label>자격</label>
                                <span th:text=${job.qualification}>무관</span>
                            </li>
                            <li>
                                <label>우대사항</label>
                                <span th:text=${job.preference}>무관</span>
                            </li>
                            <li>
                                <label>행사유형</label>
                                <span th:text=${job.eTypeName}>무관</span>
                            </li>
                        </ul>
                    </div>
        
                    <!-- 근무조건 섹션 -->
                    <div class="section">
                        <h2 class="sub-title">근무조건</h2>
                        <ul class="list">
                            <li>
                                <label>수당</label>
                                <span th:text="|${#numbers.formatInteger(job.pay, 0, 'COMMA')}원|">120,000원</span>
                            </li>
                            <li>
                                <label>근무시간</label>
                                <span th:text=${job.wHour}>6개월 ~ 1년</span>
                            </li>
                            <li>
                                <label>근무시작일</label>
                                <span th:text="${#dates.format(job.wSday, 'yyyy-MM-dd')}">행사</span>
                            </li>
                            <li>
                                <label>근무종료일</label>
                                <span th:text="${#dates.format(job.wEday, 'yyyy-MM-dd')}">정규직</span>
                            </li>
                            <li>
                                <label>위치</label>
                                <span th:text=${job.loc}>대구</span>
                            </li>
                            <li>
                                <label>복리후생</label>
                                <span>중식제공, 석식제공</span>
                            </li>
                        </ul>
                    </div>
                </div>
    
                <div class="right">
                    <div class="section manager-info-area">
                        <h2 class="sub-title"th:text="|작성자: ${job.userId}|">작성자</h2>
                        	<div id="iconSection">
                        			<div id="iconView">
		                            	<!-- 조회수 -->
		                            	<span style='font-size: 30px;'>&#128065;</span>
								 		<span id="inqNum" th:text="${job.see}"></span>
							 		</div>
							 		
							 		<div id="iconBan">
		                                <!-- 신고수 및 버튼 -->
										<th:block sec:authorize="!isAuthenticated()">
											<span th:onclick="|location.href='@{/loginPage}'|" style='font-size: 20px; cursor: pointer;'>&#128680;</span>
											<span th:text=${job.rprt}></span>
										</th:block>
										<th:block sec:authorize="isAuthenticated()">
											<th:block th:if="|${session.member.getUserId()}| != ${job.userId} ">
												<span id="modalUp" style='font-size: 20px; cursor: pointer;'>&#128680;</span>
											</th:block>
											<th:block th:if="|${session.member.getUserId()}| == ${job.userId} ">
												<span style='font-size: 20px;'>&#128680;</span>
											</th:block>
											<span th:text=${job.rprt}></span>
										</th:block>
									</div>
									
									<div id="iconLike">
										<!-- 좋아요 -->
										<th:block th:if ="${like == null}">		
											  	<div id="love" class="stage heart" style="margin: -30px -5px;"></div>
										</th:block>
										<th:block th:if ="${like != null}">		
											  	<div id="love" class="stage heart active" style="margin: -30px -5px;"></div>
										</th:block>	
									</div>
								</div>
                    		</div>
							<!-- 로그인시 신청자조회, 수정, 삭제 버튼 나타남 -->
					        <th:block th:if="${session.member.userId} == ${job.userId}">
					                    <!-- 검색, 버튼 영역 -->
					                    <div class="search-area" style="display:flex;">
					                    	<div>
						                        <button type="button"  class="button user-search-button" 
												th:onclick="|location.href='@{resumeJob(jobNo=${job.jobNo})}'|">신청자조회</button>
											</div>
											<div>
												<button type="button"  class="button post-button" 
														th:onclick="|location.href='@{jobUpdate(jobNo=${job.jobNo})}'|">수정</button>
											</div>
											<div>
												<button type="button"  class="button post-button" 
														th:onclick="|location.href='@{jobDelete(jobNo=${job.jobNo})}'|">삭제</button>
											</div>
					                    </div>
					         </th:block>
                	</div>
            	</div>
            <div style="border-top:1px solid #ddd; padding:10px; text-align:center;">
             <h2 class="sub-title">이미지</h2>
				<img th:src="|/fileView/${job.img}|" style="width: 100%;margin:0 auto;" class="img-fluid" alt="Colorlib Template">
			</div>
        </div>

        <!-- 탭 메뉴 -->
      <!--   <ul class="tabs">
            <li class="tab">
                <a href="#location">근무지역</a>
            </li>
            <li class="tab">
                <a href="#detail">상세모집요강</a>
            </li>
            <li class="tab">
                <a href="#company">채용기업정보</a>
            </li>
        </ul> -->
        <!-- 상세 영역 -->
      <!--   <div class="detail-main">
            근무지역
            <div class="detail-section location-area">
                <h2 class="sub-title" id="location">근무지역</h2>
                <p th:text=${job.loc}>서울 송파구 백제고분로12길 12 1층</p>
            </div>
            
            상세모집요강
            <div class="detail-section">
                <h2 class="sub-title" id="detail">상세모집요강</h2>
                <div class="detail-image-wrap">
                   이미지
					<img th:src="|/fileView/${job.img}|" style="width: 250px; height: 250px" class="img-fluid" alt="Colorlib Template">
                </div>
            </div>
            
        </div> -->
	</div>
   <!-- 등록 폼 -->
   <div id="modal" class="modal">
		<div class="modal_content">
			<h1>등록완료!</h1>
			<div id="button_box">
				<button type="button" id="modal_close_btn">닫기</button>
			</div>
		</div> 
		<div class="modal_layer"></div>
	</div>
	
	<!-- 이미지 나타내기 -->	
			<div th:each="f : ${file}">
			</div>
			
	<!-- 신고 등록 폼 -->
    <div id="ban" class="modal">
			<div class="modal_content">
				<h2>신고</h2>
				<div id="box">
					<label>신고게시글</label>
					<input type="text" id="targetId" name="targetId" th:value="${job.jobNo}" readonly><br>
					<label>신고자</label>
					<input type="text" id="userId" name="userId" th:value="${session.member.userId}"><br>
					<label>신고사유</label>
					<textarea rows="5" cols="30" id="banCntn" name="banCntn" placeholder="신고사유에 대해 작성해주세요."></textarea>
					<button type="button" id="cancel">취소</button>
					<button type="button" id="punish">신고</button>
				</div>
			</div>
		<div class="modal_layer"></div>
	</div>
			
<script>
//script에서 th값 가져올때는 <!--/*[[]]*/*/-->대괄호 쓰기!

	//csrf 설정
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");

	let userId = '[[${session.member.userId}]]';
	let jobNo = '[[${job.jobNo}]]';
	let type = 'T03';
	
 $(function(){
	let result = '[[${result}]]' 
	if(result !="") {
		$("#modal").show();
		}	
	}) 
	/*모달 창 닫기*/
	$("#modal_close_btn").on('click', function() {
		$("#modal").hide();
	});
				
	//좋아요를 눌렀을 경우
	   $(".heart").on("click", function() {
		 //클래스가 없을 경우 생성, 클래스가 있을 경우 삭제
	     $(this).toggleClass("active");
	     let userId = '[[${session.member.userId}]]';
	     //상세조회에서 no찾는 방법
	     let targetNo =  '[[${job.jobNo}]]';
	     let category = "T03";
	     
	     //좋아요를 추가했을 경우
	     if($(this).hasClass("active")){
	    	 //post방식으로 좋아요 등록하기
	    	 $.ajax({
					url : "/likes/lInsert",
					method : 'post',
					contentType : 'application/x-www-form-urlencoded',
					data : {userId:userId, targetNo:targetNo, category:category},
					beforeSend : function(xhr)
	                {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
	    				xhr.setRequestHeader(header, token);
	                },
					success : function(data) {
						//alert('좋아요 등록 완료');
					},
					fail : function(result) {
						alert('필수항목을 입력해주세요')
					}
				})
	     } else if (!$(this).hasClass("active")){ //좋아요를 취소했을 경우
	    	//post방식으로 좋아요 취소하기
	    	 $.ajax({
					url : "/likes/lDelete",
					method : 'post',
					contentType : 'application/x-www-form-urlencoded',
					data : {userId:userId, targetNo:targetNo, category:category},
					beforeSend : function(xhr)
	                {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
	    				xhr.setRequestHeader(header, token);
	                },
					success : function(data) {
						//alert('좋아요 취소 완료');
					},
					fail : function(result) {
						alert('필수항목을 입력해주세요')
					}
				})
	     }
	   });
	 //신고부분
	   //신고 모달창 띄우기
	   $('#modalUp').on('click', function() {
		   console.log('클릭');
		   $("#ban").show();
	   })
	   
	   //모달창에서 취소를 눌렀을 경우
	   $("#cancel").on('click', function() {
			$("#ban").hide();
		});
	   
	   //모달창에서 신고를 눌렀을 경우
	   $("#punish").on('click', function() {
		   let targetId = $("#targetId").val();
		   let banCntn = $("#banCntn").val();
		   let writer = "[[${job.userId}]]"
		   let banType = 'P1';
		    $.ajax({
					url : "/punishInsert",
					method : 'post',
					contentType : 'application/x-www-form-urlencoded',
					data : {userId:userId, targetId:jobNo,banType:banType, banCntn:banCntn, targetCat:type, writer:writer},
					beforeSend : function(xhr)
	                {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
	    				xhr.setRequestHeader(header, token);
	                },
					success : function(data) {
						alert('신고되었습니다.');
						$("#ban").hide();
					},
					fail : function(result) {
						alert('필수항목을 입력해주세요')
					}
			})
	   });
</script>
</div>
</body>	
</html>