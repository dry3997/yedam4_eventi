<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
   layout:decorate="~{layouts/default_layout}">
<head>
   <link rel="stylesheet" href="index.css" />
   <link rel="stylesheet" href="eventi.css" />
   <!-- 구글 폰트 아이콘 -->
   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

<style>
.heart {
  width: 100px;
  height: 100px;
  background: url("https://cssanimation.rocks/images/posts/steps/heart.png") no-repeat;
  background-position: 0 0;
  cursor: pointer;
  transition: background-position 1s steps(28);
  transition-duration: 0s;
  }

.active {
	transition-duration: 1s;
	background-position: -2800px 0;
}

.border {
	border: 1px solid black;
	border-radius: 5px;
	padding: 5px;
	width: 15%;
}
.like{
	float:right;	
	
}
/* 메뉴 영역*/
.content-wrap {
    width: 1400px;
    margin: 60px auto 0;
}
.option-area,
.card-area {
    padding: 0 16px;
}
.filtering-area {
    margin-bottom: 16px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--light-gray);
}

/* 필터링 영역 */
.filtering-area {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.filteringbox > h2,
.selectbox {
    display: inline-block;
    font-size: 20px;
}
.filteringbox > h2 {
    margin-right: 16px;
    font-weight: normal;
}
.selectbox {
    border: none;
    outline: none;
    font-weight: bold;
    color: var(--main-color);
    cursor: pointer;
}
.select-item {
    font-size: 14px;
    margin: 100px;
    color: #000;
    cursor: pointer;
}
/* 필터링 영역 끝 */

/* 검색, 버튼 영역 */
.search-area {
    display: flex;
    gap: 6px;
}
.searchbox,
.button {
    display: inline-block;
    height: 40px;
    padding: 12px;
    border-radius: 3px;
}
.searchbox {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 300px;
    border: 1px solid var(--light-gray);
}
.searchbox > input {
    width: 100%;
    margin-right: 12px;
    border: none;
    outline: none;
}
.searchbox > input::placeholder {
    color: var(--light-gray);
}
.searchbox > i {
    color: var(--main-color);
    cursor: pointer;
}

.button {
    cursor: pointer;
}
.user-search-button {
    background: #fff;
    border: 1px solid var(--light-gray);
}
.post-button {
    background: var(--main-color);
    border: none;
    color: #fff;
}
/* 검색, 버튼 영역 끝 */

/* 정렬 영역 */
.sorting-area {
    text-align: right;
    margin-bottom: 12px;
}
.sortingbox {
    border: none;
    outline: none;
    font-size: 14px;
    cursor: pointer;
}
/* 정렬 영역 끝 */

/* 카드 영역 */
.card-wrap {
    display: flex;
    gap: 26px;
    flex-wrap: wrap;

}
.card {
    display: inline-block;
    width: 252px;
    height: 380px;
    border-radius: 6px;
    border: 1px solid var(--light-gray);
    cursor: pointer;
    overflow: hidden;
}
.card:last-of-type {
    margin-right: none;
}
.card-image-wrap {
    position: relative;
}
.card-image-wrap > i {
    position: absolute;
    top: 12px;
    right: 12px;
    cursor: pointer;
}
.card-image-wrap {
    height: 230px;
    overflow: hidden;
}
.card-image-wrap > img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.card-info-wrap {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 16px;
    height: calc(380px - 230px);
}
.card-info-wrap > h3 {
    font-weight: bold;
    font-size: 18px;
}
.card-detail-wrap > li {
    font-size: 14px;
}
.card-detail-wrap > li:last-of-type {
    margin-top: 4px;
}
.card-detail-wrap label {
    margin-right: 4px;
    font-weight: bold;
    color: var(--main-color);
}
/* 카드 영역 끝 */
@import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/static/pretendard-dynamic-subset.css");

:root {
	--main-color: #FAB955;
	--light-gray: #dbdbdb;
}

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video,
textarea {
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 100%;
	font: inherit;
	vertical-align: baseline;
	box-sizing: border-box;
}
a {
	color: inherit;
	text-decoration: none;
}

/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
	display: block;
}
body * {
	font-family: 'Pretendard';
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}
ol, ul, li {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}

</style>
</head>
<body>
<div layout:fragment="content">
 <section id="picture "class="module bg-dark-60 gallery-page-header parallax-bg" data-background="/images/job.jpeg" style="background-image: url(&quot;assets/images/job.jpeg&quot;); background-size: 100%;">
          <div class="container">
            <div class="row">
              <div class="col-sm-6 col-sm-offset-3">
                <h2 class="module-title font-alt" style="margin: 0;">구인게시판</h2>
              </div>
            </div>
          </div>
</section>

<div class="content-wrap">
        <form id="searchForm">
            <div class="option-area">
                <div class="filtering-area">
                    <!-- 필터링 영역 -->
                    <div class="filteringbox">
                        <h2>행사 유형</h2>
                            	<select class="selectbox" id="etype" name="eType"  onchange="gopage(1)">
								<option value="" selected>------</option>
								<option value="E00" th:selected="${jobBoardVO.eType=='E00'}" >기타</option>
								<option value="E01" th:selected="${jobBoardVO.eType=='E01'}" >결혼식</option>
								<option value="E02" th:selected="${jobBoardVO.eType=='E02'}" >돌잔치</option>
								<option value="E03" th:selected="${jobBoardVO.eType=='E03'}" >개인행사</option>
								<option value="E04" th:selected="${jobBoardVO.eType=='E04'}" >기업행사</option>
								<option value="E05" th:selected="${jobBoardVO.eType=='E05'}" >각종축제</option>
								<option value="E06" th:selected="${jobBoardVO.eType=='E06'}" >기념식</option>
								<option value="E07" th:selected="${jobBoardVO.eType=='E07'}" >가요제</option>
								<option value="E08" th:selected="${jobBoardVO.eType=='E08'}" >플리마켓</option>
								<option value="E09" th:selected="${jobBoardVO.eType=='E09'}" >체육대회</option>
								<option value="E10" th:selected="${jobBoardVO.eType=='E10'}" >단합행사</option>
								<option value="E11" th:selected="${jobBoardVO.eType=='E11'}" >세미나</option>
								<option value="E12" th:selected="${jobBoardVO.eType=='E12'}" >포럼</option>
								<option value="E13" th:selected="${jobBoardVO.eType=='E13'}" >워크샵</option>
								<option value="E14" th:selected="${jobBoardVO.eType=='E14'}" >전시회</option>
								<option value="E15" th:selected="${jobBoardVO.eType=='E15'}" >박람회</option>
								<option value="E00" th:selected="${jobBoardVO.eType=='E00'}" >기타</option>
							</select> 
                    </div>

                    <!-- 검색, 버튼 영역 -->
                    <div class="search-area">
                        <div class="searchbox" style="margin-top:35px">
	                        <input type="text" name="title" placeholder="검색어를 입력해주세요" th:value="${param.title}">
						
	                            <i class="material-symbols-outlined" id="find" onclick="gopage(1)">search</i>
	                     </div>
	                        <button type="button" style="margin-top:35px" class="button user-search-button" onclick="jobInsert()" sec:authorize="isAuthenticated()">구인등록</button>
	                        <button type="button"  style="margin-top:35px" class="button post-button" onclick="resumeList()" sec:authorize="isAuthenticated()">지원자조회</button>
	                     
		                    <!-- 라디오 버튼 전체 정렬 -->
		                    <input type="radio" name="showAll" value="all" >전체
		                    
		                    <!-- 좋아요 -->	
							<div class="stage" style="margin-top: 5px;">
								<div id="love" class="stage heart" th:classappend="${param.userId} !=null ? active" sec:authorize="isAuthenticated()" ></div>
							</div>				
                	</div>
            	</div>
                <!-- 정렬 영역 -->
                <div class="sorting-area">
				     <select class="sortingbox" id="see" name="orderCol" onchange="gopage(1)">
						<option value="" th:selected="${#strings.equals(param.orderCol, '')}">------</option>
						<option value="dt" th:selected="${#strings.equals(param.orderCol, 'dt')}">작성순</option>
						<option value="see" th:selected="${#strings.equals(param.orderCol, 'see')}">조회수</option>
						<option value="cnt" th:selected="${#strings.equals(param.orderCol, 'cnt')}">좋아요순</option>
					</select>
                </div>
            </div>
    	</form>
    	
            <!-- 카드 영역 -->
            <div class="card-area">
                <ul class="card-wrap">
                    <li class="card" th:each="job : ${jobList}" th:myName = "${job.jobNo}" th:onclick="jobDetail(this.getAttribute('myName'))">
                        <div class="card-image-wrap">
                        	<div th:id="${job.jobNo}" style="position: absolute; right: -9px; top: -9px; z-index: 3;" class="stage heart" th:classappend="${job.likes} =='1' ? active" sec:authorize="isAuthenticated()" ></div>
                            <img th:src="|/fileView/${job.img}|" style="width:100%; height:100%; object-fit:cover;" class="img-fluid" alt="Colorlib Template">
                        </div>
                        <div class="card-info-wrap">
                            <h3 th:text=${job.title}>설날 행사 스텝 모집합니다</h3>
                            <ul class="card-detail-wrap">
                                <li>
                                	<label>마감상황</label>
                                	<th:block th:if="${job.remain > 0}">
										<td  th:text="|${job.remain} 일전|"></td>
									</th:block>
									<th:block th:unless="${job.remain > 0} ">
										<td th:text="마감"></td>
									</th:block>
                                
                                </li>
                                <li>
                                    <label >지원</label>
                                    <span th:text="|${job.reCount}명|">10명</span>
                                </li>
                                <li>
                                    <label >작성자</label>
                                    <span th:text="${job.userId}">10명</span>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

	<div class="row mt-5">
		 <div class="col text-center">
			<div class="block-27">
				<th:block th:replace="fragments/paging :: component(${paging},'gopage')">
		    </div>
		 </div>
	</div>
		        
	<!-- 이미지 나타내기 -->	
	<div th:each="f : ${file}">
		<a><img th:src="|/fileView/${f.sevNm}|" style="width: 250px; height: 250px" class="img-fluid" alt="Colorlib Template"></a>
	</div>	
	        
<script>
	//csrf 설정
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	
	//페이징
	function gopage(i) {
	    location.href = `/jobList?page=${i}&orderCol=${document.querySelector("#see").value}&title=${$("input[name=title]").val()}`;
	}
	//링크
	link1 = 'jobInsert'; //구인등록폼 이동
	function jobInsert(){
		location.href = link1;
	}
	
	let userId = '[[${session.member != null ? session.member.userId :''}]]';
	link2 = 'resumeList?userId=';//신청자전체조회
	function resumeList(userId){
		location.href = link2+userId;
	}
	
	
	link3 = 'jobDetail?jobNo='; //게시글 상세조회
	function jobDetail(jobNo){
		console.log(jobNo)
		location.href = link3+jobNo;
	}
	//정렬
	function order(){
		console.log('클릭');
		let param = $("#searchForm").serialize()
		location.href=`/jobList?${param}`
	}
	
	//라디오 버튼 정렬 클릭시
	$("input:radio[name=showAll]").click(function () {
		location.href = `/jobList?`;
	})
	
	//검색 기능
	$('#find').click(function() {
		gopage(1);
		//입력한 값 가져오기
		/* let search = $("input[name=search]").val();
		
	$.ajax({
		url : '/jobList',
		method : 'post',
		data : {title:search}, //title = search(title변수안에 data)
		beforeSend : function(xhr)
        {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
		/* 	xhr.setRequestHeader(header, token);
        }
	}).then(res => {
		//tbody밑에 있는 데이터 지우기
		
		$("#check").empty();
		
		//tbody에 들어갈 tr 생성
		for(r of res){ //제목, 내용 검색 시
			$("#check").append(makeTr(r));
		} 
	})*/
		
	$("input[name=title]").val(''); 
	})
	
	//tr 생성 함수
	function makeTr(r){
	console.log(r)
	let tr = `<tr onclick="location.href='/jobDetail?jobNo=${r.jobNo}'">
					<td>${r.jobNo}</td>
					<td>${r.title}</td>
		 			<td>${r.etype}</td> 
					<td>${r.userId}</td>
			  </tr>`
	return tr;
	}
	
	//좋아요를 눌렀을 경우
	$(".heart").on("click", function(e) {
		$(this).toggleClass("active");
		let etype = $("#etype").val();
		let userId = '[[${session.member != null ? session.member.userId :""}]]';
		let targetNo = $(this).attr('id');
		let category = "T03";
		e.stopImmediatePropagation(); 
		
	//좋아요를 추가했을 경우 
	if($(this).hasClass("active")){
   	 $.ajax({
		url : "/likes/lInsert",
		method : 'post',
		contentType : 'application/x-www-form-urlencoded',
		data : {userId:userId, targetNo:targetNo, category:category},
		beforeSend : function(xhr)
             {  
 				xhr.setRequestHeader(header, token);
             },
		success : function(data) {
		},
		fail : function(result) {
			alert('필수항목을 입력해주세요')
		}
		})
	} else if (!$(this).hasClass("active")){ //좋아요를 취소했을 경우
    	//post방식으로 좋아요 취소하기
    	 $.ajax({
				url : "/likes/lDelete",
				method : 'post',
				contentType : 'application/x-www-form-urlencoded',
				data : {userId:userId, targetNo:targetNo, category:category},
				beforeSend : function(xhr)
                {
    				xhr.setRequestHeader(header, token);
                },
				success : function(data) {
				},
				fail : function(result) {
					alert('필수항목을 입력해주세요')
				}
			})
    	}		
	});
		</script>
		</div>
	</body>
</html>