<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/default_layout}">

<div layout:fragment="content">
<section class="hero-wrap hero-wrap-2 mb-4 "
      style="background-image: url(&quot;images/bg_2.jpg&quot;); background-position: 50% 0%;"
      data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
         <div
            class="row no-gutters slider-text align-items-end justify-content-center">
            <div
               class="col-md-9 ftco-animate mb-5 text-center fadeInUp ftco-animated">
               <h2 class="mb-0 bread">구직자조회</h2>
            </div>
         </div>
      </div>
   </section>
<button type="button" id="hireBtn">채용</button>
	<table class="table mb-3" >
	<thead class="thead-dark">
			<tr>
				<th><input type="checkBox" value="채용" class="hire" id="allHire" 
					></th> <!-- th:if="${res.hire} == 'Y'" disabled -->
				<th>구직신청게시글번호</th>
				<th>구직자ID</th> 
				<th>구직자정보</th>
				<th>구인게시글번호</th>
				<th>채용여부</th>
			</tr>		
		</thead>
		<tbody>
			<tr th:each="res : ${resumeList}">
			<td><input class="hire" type="checkBox" value="hire" onkeyup="hire()"></td>
				<td th:text=${res.resumeNo}></td>
				<td th:text=${res.seekerId}></td>
				<td th:text=${res.seekerCntn}></td>
				<td th:text=${res.jobNo}>  [[${res.hire}]]</td>
				<td th:if="${res.hire} == 'Y'">채용</td>
				<td th:unless="${res.hire} == 'Y'">미채용</td>
			</tr>
		</tbody>
	</table>


<script>
var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");

//tr 전체체크시 모든항목 체크되도록 
let allHire = document.querySelector("#allHire")
let hireCheck = document.querySelector(".hire")
allHire.addEventListener('change', function(){
	//forEach 반복문 사용
	document.querySelectorAll('input[value="hire"]').forEach(function(hireCheck){
		hireCheck.checked = allHire.checked;
	})
})
//구직자 채용
document.querySelector('#hireBtn').addEventListener('click', hireSeeker);
function hireSeeker(hireCheck){
	let trs = document.querySelectorAll('table>tbody>tr');
	
	if(!confirm('해당 회원을 채용하시겠습니까?')){
		return false;
	}else{
		for (let i = 0; i < trs.length; i++) {
			if (trs[i].children[0].children[0].checked) {
				//alert(trs[i].children[0])
				let resumeNo = trs[i].children[1].textContent; //체크된 공모번호

				//업데이트처리 ajax
  				$.ajax({
					url: '/hireUpdate',
					method: "post",
					data: {resumeNo},
					beforeSend: function (xhr) {
						/*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
						xhr.setRequestHeader(header, token);
					},
				}).then(res => {
					if (res == 1) {
						location.href=`/resumeList`
						alert('채용 완료');
					} else {
						alert('채용이 불가능합니다.');
					}
				})   
			}
		}
	}
}

</script>
</div>
</html>