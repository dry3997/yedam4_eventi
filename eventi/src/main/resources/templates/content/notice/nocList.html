<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/default_layout}">
   
<head>
</head>
<style>
body {
  padding:1.5em;
  background: #f5f5f5
}

table {
  border: 1px #a39485 solid;
  font-size: .9em;
  box-shadow: 0 2px 5px rgba(0,0,0,.25);
  width: 100%;
  border-collapse: collapse;
  border-radius: 5px;
  overflow: hidden;
}

th {
  text-align: left;
}
  
thead {
  font-weight: bold;
  color: #fff;
  background: #73685d;
}
 
 td, th {
  padding: 1em .5em;
  vertical-align: middle;
}
  
 td {
  border-bottom: 1px solid rgba(0,0,0,.1);
  background: #fff;
}

  
 @media all and (max-width: 768px) {
    
  table, thead, tbody, th, td, tr {
    display: block;
  }
  
  th {
    text-align: right;
  }
  
  table {
    position: relative; 
    padding-bottom: 0;
    border: none;
    box-shadow: 0 0 10px rgba(0,0,0,.2);
  }
  
  thead {
    float: left;
    white-space: nowrap;
  }
  
  tbody {
    overflow-x: auto;
    overflow-y: hidden;
    position: relative;
    white-space: nowrap;
  }
  
  tr {
    display: inline-block;
    vertical-align: top;
  }
  
  th {
    border-bottom: 1px solid #a39485;
  }
  
  td {
    border-bottom: 1px solid #e5e5e5;
  }
}  
</style>
<div layout:fragment="content">
<section class="module bg-dark-60 gallery-page-header parallax-bg" data-background="assets/images/gallery_bg.jpg" style="background-image: url(&quot;assets/images/gallery_bg.jpg&quot;);">
          <div class="container">
            <div class="row">
              <div class="col-sm-6 col-sm-offset-3">
                <h2 class="module-title font-alt">공지사항게시판</h2>
                <div class="module-subtitle font-serif">Small Title</div>
              </div>
            </div>
          </div>
        </section>
	<button type="button" class="btn btn-outline-primary" 
	th:onclick="|location.href='@{nocInsert}'|">공지사항등록</button>
	
	<!-- 게시글 검색 -->
	<form action="/nocList">
	<input type="text" name="ttl">
	<input type="submit" id="find" value="찾기">
	</form>
	
	<table>
	<thead>
			<tr>
				<th>공지사항번호</th>
				<th>공지사항제목</th>
				<th>작성일자</th>
				<th>조회수</th>
			</tr>			
		</thead>
		<tbody>
			<tr th:each="noc : ${nocList}" th:onclick="|location.href='@{nocDetail(noticeNo=${noc.noticeNo})}'|">
				<td th:text=${noc.noticeNo}></td>
				<td th:text=${noc.ttl}></td>
				<td th:text=${noc.dt}></td>
				<td th:text=${noc.see}></td>
			</tr>
		</tbody>
	</table>
	
	<!-- 페이징 처리 -->
		<div class="row mt-5">
          <div class="col text-center">
            <div class="block-27">
               <th:block th:replace="fragments/paging :: component(${paging},'gopage')">
            </div>
          </div>
        </div>
        
<script>
//csrf 설정
var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");

//페이지 이동 
function gopage(i) {
    console.log(i);
    location.href = '/nocList?page=' + i;
}

//검색기능

$('#find').click(function() {
	//입력한 값 가져오기
	let search = $("input[name=search]").val();
	
	$.ajax({
		url : '/nocList',
		method : 'post',
		data : {ttl:search}, //title = search(title변수안에 data)
		beforeSend : function(xhr)
        {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
			xhr.setRequestHeader(header, token);
        }
	}).then(res => {
		//tbody밑에 있는 데이터 지우기
		
		$("#check").empty();
		
		//tbody에 들어갈 tr 생성
		for(r of res){ //제목, 내용 검색 시
			//if(r.title.includes(search) || r.jobCntn.includes(search)){
				//alert(r.loc)
				$("#check").append(makeTr(r));
   			//}
		}
	})
		
	$("input[name=search]").val('');
	})
//tr 생성 함수
function makeTr(r){
console.log(r)
let tr = `<tr onclick="location.href='/nocDetail?noticeNo=${r.noticeNo}'">
				<td>${r.noticeNo}</td>
				<td>${r.ttl}</td>
	 			<td>${r.dt}</td> 
				<td>${r.userId}</td>
		  </tr>`
return tr;		
}	

</script>	
</div>
</html>
