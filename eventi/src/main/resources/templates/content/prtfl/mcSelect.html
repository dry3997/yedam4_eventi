<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/default_layout}">
   
<head>
<!-- csrf 설정 -->
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<link href="/css/star.css" rel="stylesheet">

	<!-- 채팅방 관련 -->
	<link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/main.css" rel="stylesheet">
	<script src="/webjars/jquery/jquery.min.js"></script>
	<script src="/webjars/sockjs-client/sockjs.min.js"></script>
	<script src="/webjars/stomp-websocket/stomp.min.js"></script>
	<script>
		let userId = '[[${session.member.userId}]]';
	</script>
	<!-- <script src="/app.js"></script> -->
	<link href="/css/chat.css" rel="stylesheet">
	<!-- 채팅방 관련 끝 -->

<style>
	footer {
		display: none;
	}

	* {
	  box-sizing: border-box;
	}
	
	#check{
		min-height : 2000px;
	}

	#left {
	  float: left;
	  width: 30%;
	  height: 300px; /* only for demonstration, should be removed */
	  padding: 20px;
	}
	
	article {
	  float: left;
	  padding: 20px;
	  width: 70%;
	  height: 300px; /* only for demonstration, should be removed */
	}
	
	.border {
		border: 1px solid black;
		border-radius: 5px;
	}
	
	.label {
		color : black;
	}
	
	#btn {
		width: 250px;
		margin:auto;
        display:block;
        margin-bottom: 3px;
	}
	
	.heart {
	  width: 100px;
	  height: 100px;
	  background: url("https://cssanimation.rocks/images/posts/steps/heart.png") no-repeat;
	  background-position: 0 0;
	  cursor: pointer;
	  transition: background-position 1s steps(28);
	  transition-duration: 0s;
	 }
	 
	 .active {
	    transiion-duration: 1s;
	    background-position: -2800px 0;
	  }
	  
	   .modal {
			display: none;
			position: fixed;
			top: 25em;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 1;
			width: 100%;
		}

		.modal h2 {
			margin: 0;
		}

		.modal button {
			display: inline-block;
			width: 100px;
			border: 0.2px solid black;
			border-radius: 5px;
		}

		.modal .modal_content {
			width: 350px;
			min-height: 200px;
			margin: 0 auto;
			padding: 20px;
			background: #fff;
			border: 0.5px solid #666;
			border-radius: 15px;
		}

		.modal .modal_layer {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
			z-index: -1;
		}
</style>
</head>

<div layout:fragment="content">

    <section class="module bg-dark-60 gallery-page-header parallax-bg" data-background="/assets/images/gallery_bg.jpg" style="background-image: url(&quot;assets/images/gallery_bg.jpg&quot;);">
     <div class="container">
       <div class="row">
         <div class="col-sm-6 col-sm-offset-3">
           <h2 class="module-title font-alt">사회자포트폴리오</h2>
           <div class="module-subtitle font-serif">사회자포트폴리오</div>
         </div>
       </div>
     </div>
   </section>
   
    <section id="check">
  <nav id="left">
  	<div class="border">
  		<label class="label" th:text="'조회수' + ${mcSelect.inq}"></label>
  		
  		<div class="stage">
  			<div id="love" class="stage heart" th:classappend="${like} != null ? active"></div>
   		</div>
   		<hr>
  		
  		<label class="label" id="userId" th:text="${mcSelect.userId}"></label>
  		<hr>
  		
  		<label class="label" th:text="${mcSelect.oneIntro}"></label>
  		<hr>
  		
  		<button id="btn" type="button" class="btn btn-primary chattingUp">1:1대화</button>
  		<button id="btn" type="button" class="btn btn-g btn-round" th:onclick="|#|">의뢰하기</button>
  		<button id="btn" type="button" class="btn btn-primary punishModalUp">신고하기</button>
  		<button id="btn" type="button" class="btn btn-g btn-round reviewModalUp">리뷰</button>
		<hr>
		
		<label class="label" th:text="${mcSelect.carrYear} + '년'"></label>
  	</div>
  </nav>
  
  <article>
    <div role="tabpanel">
                  <ul class="nav nav-tabs font-alt" role="tablist">
                    <li class="active"><a href="#support" data-toggle="tab" aria-expanded="true"><span class="icon-tools-2"></span>포트폴리오</a></li>
                    <li class=""><a href="#sales" data-toggle="tab" aria-expanded="false"><span class="icon-tools-2"></span>후기</a></li>
                  </ul>
                  <div class="tab-content">
                    <div class="tab-pane active" id="support">
                    	<div class="border">
							<label class="label">세부분야</label> 
							<label class="label" th:text="${mcSelect.mcType}"></label><br>
							<label class="label">진행스타일</label> 
							<label class="label" th:text="${mcSelect.progStyle}"></label><br>
							<label class="label">자격증</label> 
							<label class="label">레크리에이션지도자1급</label><br>
							<label class="label">섭외비</label> 
							<label class="label" th:text="${mcSelect.castingPrice}+'원'"></label> 
                    	</div>
                    	
                    	<br>
                    	<h5>자기소개</h5>
                    	<div class="border">
							<label class="label" th:utext="${mcSelect.selfIntro}"></label><br>
                    	</div>
                    	
                    	<br>
                    	<h5>경력사항</h5>
                    	<div class="border">
							<label class="label" th:utext="${mcSelect.career}"></label><br>
                    	</div>
            			
            			<br>
                    	<h5>동영상</h5>
                    	<div class="border">
							<video th:each="file : ${files}" th:if="${#strings.containsIgnoreCase(file,'.mp4')}" th:src="|/fileView/${file.sevNm}|" width="500px" height="200px" controls></video>
                    	</div>
                    	
                    	<br>
                    	<h5>댓글</h5>
                    	<div class="border">
					        <ul class="comment-list" id=reply></ul>
					        
					        <!-- 댓글 작성 -->
						    <form id="replyInsertFrm">
						    	<textarea name="replyCntn" id="replyCntn" cols="30" rows="4" placeholder="댓글을 입력하세요."></textarea>
						    	<button type="button" id="repInsertBtn">댓글추가</button>
						    </form>
                    	</div>
                    </div>
                    
                    <!-- 후기카테고리 -->
                    <div class="tab-pane" id="sales">
                    	<div class="tab-pane active" id="reviews">
		                    <div class="comments reviews" th:each="re : ${reviews}">
		                      <div class="comment clearfix">
		                        <div class="comment-content clearfix">
		                          <div class="comment-author font-alt" th:text="${re.userId}"></div>
		                          <div class="comment-body">
		                            <p th:text="${re.reviewCntn}">The European languages are members of the same family. Their separate existence is a myth. For science, music, sport, etc, Europe uses the same vocabulary. The European languages are members of the same family. Their separate existence is a myth.</p>
		                          </div>
		                          <div class="comment-meta font-alt">Today, 14:55 -<span><i class="fa fa-star star"></i></span><span><i class="fa fa-star star"></i></span><span><i class="fa fa-star star"></i></span><span><i class="fa fa-star star"></i></span><span><i class="fa fa-star star-off"></i></span>
		                          </div>
		                        </div>
		                      </div>
	                    	</div>
	                  	</div>
                    </div>
                  </div>
                </div>
  </article>
</section>
	
	<!-- 신고 폼 -->
	<div id="punishFrm" class="modal">
			<div class="modal_content">
				<h2>신고</h2>
				<div id="box">
					<label>신고대상자</label>
					<input type="text" id="targetId" name="targetId" th:value="${mcSelect.userId}" readonly><br>
					<label>신고자</label>
					<input type="text" id="userId" name="userId" th:value="${session.member.userId}"><br>
					<label>신고사유</label>
					<textarea rows="5" cols="30" id="banCntn" name="banCntn" placeholder="신고사유에 대해 작성해주세요."></textarea>
					<button type="button" id="cancel">취소</button>
					<button type="button" id="punish">신고</button>
				</div>
			</div>
		<div class="modal_layer"></div>
	</div>
    
    <!-- 후기 폼 -->
    <div id="reviewFrm" class="modal">
			<div class="modal_content">
				<label>대상</label>
				<input type="text" id="reviewTgt" name="reviewTgt" th:value="${mcSelect.userId}" readonly><br>
				
				<label>의뢰자</label>
				<input type="text" id="userId" name="userId" th:value="${session.member.userId}" readonly><br>
				
				<label>별점</label>
				<div class="starpoint_wrap">
				  <div class="starpoint_box">
				    <label for="starpoint_1" class="label_star" title="0.5"><span class="blind">0.5</span></label>
				    <label for="starpoint_2" class="label_star" title="1"><span class="blind">1</span></label>
				    <label for="starpoint_3" class="label_star" title="1.5"><span class="blind">1.5</span></label>
				    <label for="starpoint_4" class="label_star" title="2"><span class="blind">2</span></label>
				    <label for="starpoint_5" class="label_star" title="2.5"><span class="blind">2.5</span></label>
				    <label for="starpoint_6" class="label_star" title="3"><span class="blind">3</span></label>
				    <label for="starpoint_7" class="label_star" title="3.5"><span class="blind">3.5</span></label>
				    <label for="starpoint_8" class="label_star" title="4"><span class="blind">4</span></label>
				    <label for="starpoint_9" class="label_star" title="4.5"><span class="blind">4.5</span></label>
				    <label for="starpoint_10" class="label_star" title="5"><span class="blind">5</span></label>
				    <input type="radio" name="starpoint" id="starpoint_1" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_2" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_3" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_4" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_5" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_6" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_7" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_8" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_9" class="star_radio">
				    <input type="radio" name="starpoint" id="starpoint_10" class="star_radio">
				    <span class="starpoint_bg"></span>
				  </div>
				</div>
				<br>
				
				<label>후기</label>
				<textarea rows="5" cols="30" id="reviewCntn" name="reviewCntn" placeholder="후기를 작성해주세요."></textarea>
				<button type="button" id="cancel">취소</button>
				<button type="button" id="review">후기등록</button>
			</div>
		<div class="modal_layer"></div>
	</div>

	<!-- 화면 하단 채팅 버튼 -->
	<div class="chat">
		<div class="background"></div>
		<svg class="chat-bubble" width="80" height="80" viewBox="0 0 100 100">
			<g class="bubble">
				<path class="line line1" d="M 30.7873,85.113394 30.7873,46.556405 C 30.7873,41.101961
          36.826342,35.342 40.898074,35.342 H 59.113981 C 63.73287,35.342
          69.29995,40.103201 69.29995,46.784744" />
				<path class="line line2" d="M 13.461999,65.039335 H 58.028684 C
            63.483128,65.039335
            69.243089,59.000293 69.243089,54.928561 V 45.605853 C
            69.243089,40.986964 65.02087,35.419884 58.339327,35.419884" />
			</g>
			<circle class="circle circle1" r="1.9" cy="50.7" cx="42.5" />
			<circle class="circle circle2" cx="49.9" cy="50.7" r="1.9" />
			<circle class="circle circle3" r="1.9" cy="50.7" cx="57.3" />
		</svg>
	</div>

	<!-- 채팅버튼 클릭시 나타날 채팅창 -->
	<div class="chat-popup">
		<div class="chat-windows">
			<div class="chat-window-one">
				<noscript>
					<h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on
						Javascript being
						enabled. Please enable
						Javascript and reload this page!</h2>
				</noscript>
				<!--채팅연결, Connect를 눌러줘야된다.-->
				<div id="main-content" class="container">
					<div class="row">
						<div class="col-md-6">
							<form class="form-inline">
								<div class="form-group">
									<label for="connect">WebSocket connection:</label>
									<button id="connect" class="btn btn-default" type="submit">Connect</button>
									<button id="disconnect" class="btn btn-default" type="submit"
										disabled="disabled">Disconnect
									</button>
								</div>
							</form>
						</div>
					</div>
				</div>

				<!-- 채팅 popup -->
				<section class="message-area">
					<div class="container">
						<div class="row">
							<div class="col-12">
								<div class="chat-area">
									<!-- 채팅방 -->
									<div class="chatlist">
										<div class="modal-dialog-scrollable">
											<div class="modal-content">
												<div class="chat-header">
													<ul class="nav nav-tabs" id="myTab" role="tablist">
														<li class="nav-item" role="presentation">
															<button class="nav-link active" id="Open-tab"
																data-bs-toggle="tab" data-bs-target="#Open"
																type="button" role="tab" aria-controls="Open"
																aria-selected="true">Open</button>
														</li>
													</ul>
												</div>

												<div class="modal-body">
													<!-- 채팅방 나타나는 곳 -->
													<div class="chat-lists">
														<div class="tab-content" id="myTabContent">
															<!-- 채팅방 리스트 -->
															<div class="chat-list">
																<a href="#" class="d-flex align-items-center">
																	<div class="flex-grow-1 ms-3">
																		<h3>Mehedi Hasan</h3>
																		<p>front end developer</p>
																	</div>
																</a>
															</div>
															<!-- 채팅방 리스트 end -->
														</div>
													</div>
													<!-- 채팅방 나타나는 곳 end -->
												</div>
											</div>
										</div>
									</div>
									<!-- 채팅방 end -->

									<!-- 채팅공간 -->
									<div class="chatbox">
										<div class="modal-dialog-scrollable">
											<div class="modal-content">
												<div class="msg-head">
													<div class="row">
														<div class="col-8">
															<!--누구랑 채팅하는지 나타냄-->
															<div class="d-flex align-items-center">
																<div class="flex-grow-1 ms-3">
																	<h3>Mehedi Hasan</h3>
																	<p>front end developer</p>
																</div>
															</div>
														</div>
													</div>
												</div>

												<!--채팅내용-->
												<div class="modal-body">
													<div class="msg-body">
														<ul id="greetings">
															<li class="sender">
																<p> Hey, Are you there? </p>
																<span class="time">10:06 am</span>
															</li>
															<li class="repaly">
																<p> Last Minute Festive Packages From Superbreak</p>
																<span class="time">10:20 am</span>
															</li>
															<li>
																<div class="divider">
																	<h6>Today</h6>
																</div>
															</li>

															<li class="repaly">
																<p> Last Minute Festive Packages From Superbreak</p>
																<span class="time">10:36 am</span>
															</li>
														</ul>
													</div>
												</div>

												<!-- 채팅 보내는 공간 -->
												<div class="send-box">
													<form action="#">
														<input type="text" id="name" class="form-control"
															aria-label="message…" placeholder="Write message…">

														<button type="button" id="send" class="btn btn-default"><i
																class="fa fa-paper-plane" aria-hidden="true"></i>
															Send</button>
													</form>

													<!--첨부파일 기능-->
													<div class="send-btns">
														<div class="attach">
															<div class="button-wrapper">
																<span class="label">
																	<img class="img-fluid"
																		src="https://mehedihtml.com/chatbox/assets/img/upload.svg"
																		alt="image title"> attached file
																</span><input type="file" name="upload" id="upload"
																	class="upload-box" placeholder="Upload File"
																	aria-label="Upload File">
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>
	</div>
	
	
   <script>
   		//csrf 설정
   		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
   		
		//해당 포트폴리오 작성자에 대한 댓글을 가져오기 위해 replyTag에 작성자ID를 구해준다.
   		let replyTgt = '[[${mcSelect.userId}]]';

   		//댓글, 대댓글 불러오는 ajax
   		$.ajax({
   			url : '/replyList',
   			method : 'post',
   			data : JSON.stringify({replyTgt:replyTgt, boardCat:'T06'}),
   			contentType : "application/json",
   			beforeSend : function(xhr)
            {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
				xhr.setRequestHeader(header, token);
            }
   		}).then(res => {
   			for(reply of res){
   				//댓글일 경우
   				if(reply.rerepTgt == null){
   					$("#reply").append(make(reply));
   				} else { //대댓글일 경우, 대댓글의 경우 rerepTgt컬럼에 대댓글을 단 댓글 번호가 적혀있다.
   					//대댓글은 연관있는 댓글 바로 밑에 들어가야되기 때문에 댓글 생성시 id를 부여하여 rerepTgt이 댓글ID와 같은 번호가 적힌 댓글 밑으로 append한다.
   					$("#" + reply.rerepTgt).append(makeRe(reply));
   				}
   			}
   		})
   		
   		//댓글 tr생성
   		function make(reply){
   			let delBtn = '';
			let upBtn = '';
			let userId = '[[${session.member != null ? session.member.userId :''}]]';
			
			//댓글 작성자일 경우에만 삭제 버튼 생성
			if(reply.userId ==userId){
				delBtn = `<button class='repDelete'>삭제</button>`;
				upBtn = `<button class='repUpdate'>수정</button>`;
			}
			
   			let p = `
                  <li class="comment">
                    <div class="comment-body"  id="${reply.replyNo}">
                      <h3>${reply.userId}</h3>
                      <div class="meta">${reply.writingDt}</div>
                      <p>${reply.replyCntn}</p>
                      <p><a href="#" class="reply">Reply</a></p>
                      ${delBtn} ${upBtn}
                    </div>
                   </li>
                `
   			return p;
   		}
   		
   		//대댓글 tr생성
   		function makeRe(reply){
   			let delBtn = '';
			let upBtn = '';
			let userId = '[[${session.member != null ? session.member.userId :''}]]';
			
			//댓글 작성자일 경우에만 삭제 버튼 생성
			if(reply.userId ==userId){
				delBtn = `<button class='repDelete'>삭제</button>`;
				upBtn = `<button class='repUpdate'>수정</button>`;
			}
   			
   			//한 댓글당 대댓글은 한개만 달수 있기 때문에 댓글에 있는 reply 버튼 삭제
   			$("#" + reply.rerepTgt).children('p:eq(1)').remove();
   			
   			let p = `<ul class="children">
                <li class="comment">
                <div class="comment-body">
                  <h3>${reply.userId}</h3>
                  <div class="meta">${reply.writingDt}</div>
                  <p>${reply.replyCntn}</p>
                  ${delBtn} ${upBtn}
                </div>
              </li>
            </ul>`
            
            return p;
   		}
   		
   	//댓글 추가
		$("#repInsertBtn").on("click", function() {
			//textarea에 있는 값 들고 오기
			let replyCntn = $('#replyCntn').val();
			let userId = '[[${session.member.userId}]]';
			
			$.ajax({
	   			url : '/replyInsert',
	   			method : 'post',
	   			data : JSON.stringify({userId:userId, replyTgt:replyTgt, replyCntn:replyCntn, boardCat:'T06'}),
	   			contentType : "application/json",
	   			beforeSend : function(xhr)
	            {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
					xhr.setRequestHeader(header, token);
	            }
	   		}).then(res => {
	   			//댓글 부분에 등록하기
	   			$("#reply").append(make(res));
	   			$('#replyCntn').val('');
	   		})
		});
		
		//reply버튼을 클릭했을 경우 대댓글 입력 폼 생성
		$(document).on('click', '.reply', function(e){
		    e.preventDefault();
		    //대댓글을 작성할 replyNo 구하기
		    let rerepTgt = $(this).parent("div").attr('id');
		    //대댓글 입력할 수 있는 폼 생성
		  	$(this).parent("div").append(makeFrm(rerepTgt));
		  	
		  	//reply버튼 숨김
		  	$(this).hide();
		})
		
		//대댓글 입력 폼
		function makeFrm(rerepTgt) {
			let form = `<form>
				<input type="hidden" id="rerepTgt" name="rerepTgt" value="${rerepTgt}">
	            <textarea class="form-control" id="replyCntn" name="replyCntn" rows="3"></textarea>
	            <button type="button" id="rerepTgt" class="reply">답변</button>
	        </form>`
		    
		    return form;
		}
		
		//대댓글 추가
		$(document).on('click', '#rerepTgt', function(e){
			let replyCntn = $('#replyCntn').val();
			let rerepTgt = $('#rerepTgt').val();
			let userId = '[[${session.member.userId}]]';
			
			$(this).parent("form").remove();
			$.ajax({
	   			url : '/replyInsert',
	   			method : 'post',
	   			data : JSON.stringify({userId:userId, replyTgt:replyTgt, replyCntn:replyCntn, boardCat:'T06', rerepTgt:rerepTgt}),
	   			contentType : "application/json",
	   			beforeSend : function(xhr)
	            {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
					xhr.setRequestHeader(header, token);
	            }
	   		}).then(res => {
	   			
	   			$("#" + res.rerepTgt).append(makeRe(res));
	   		})
		})
		
		//댓글 삭제
		$(document).on('click', '.repDelete', function(e){
			let btn=$(this);
			let replyNo = $(this).parent("div").attr('id');
			$.ajax({
				url : '/replyDelete',
				type : 'POST',
				data : {
					replyNo : replyNo
				},
				beforeSend: function (xhr) {
					/*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
					xhr.setRequestHeader(header, token); //403오류, type post일때 넣기
				},
				success : function(result){
					if(result ==1){
					btn.closest(".comment").remove();
				}
			}
		});		
	});
		
		//댓글 수정 폼으로 변경
		$(document).on('click', '.repUpdate', function(e){
			let replyNo = $(this).parent("div").attr('id');
			let p = $(this).parent("div").children("p").text();			
			$(this).parent().children('p').replaceWith("<div><input type='hidden' id='replyNo' name='replyNo' value='" + replyNo +"'></input> <input type='text' id='replyCntn' name='replyCntn' value='" + p + "'></input>");
			
			$(this).toggleClass("updateBtn");
		});
		
		//댓글 수정
		$(document).on('click', '.updateBtn', function(e){
			$(this).toggleClass("updateBtn");
			let btn = $(this);
			let replyCntn = $('#replyCntn').val();
			let replyNo = $('#replyNo').val();
			let updateBtn = `<button class='repUpdate'>수정</button>`;
			
			$.ajax({
				url : '/replyUpdate',
				type : 'POST',
				data : JSON.stringify({replyNo : replyNo, replyCntn : replyCntn}),
				contentType : "application/json",
				beforeSend: function (xhr) {
					/*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
					xhr.setRequestHeader(header, token); //403오류, type post일때 넣기
				},
				success : function(result){
					btn.parent().children('div:eq(1)').replaceWith("<p>" + result.replyCntn + "</p>");
				}		
			})
		});
   		
   	 $(".heart").on("click", function() {
		 $(this).toggleClass("active");
		 let userId = '[[${session.member.userId}]]';
		 let targetNo = '[[${mcSelect.userId}]]';
		 let category = 'T06';
		 
		 //좋아요를 추가했을 경우
	     if($(this).hasClass("active")){
	    	 //총 좋아요수 처리
	    	 let likeCount = $('#likeCount').text();
	    	 $('#likeCount').text(parseInt(likeCount) + 1);
	    	 
	    	 //post방식으로 좋아요 등록하기
	    	 $.ajax({
					url : "/likes/lInsert",
					method : 'post',
					contentType : 'application/x-www-form-urlencoded',
					data : {userId:userId, targetNo:targetNo, category:category},
					beforeSend : function(xhr)
	                {  
	    				xhr.setRequestHeader(header, token);
	                },
					success : function(data) {
					},
					fail : function(result) {
						alert('필수항목을 입력해주세요')
					}
				})
	     } else if (!$(this).hasClass("active")){ //좋아요를 취소했을 경우
	    	 //총 좋아요수 처리
	    	 let likeCount = $('#likeCount').text();
	    	 $('#likeCount').text(parseInt(likeCount) - 1);
	    	 
	    	//post방식으로 좋아요 취소하기
	    	 $.ajax({
					url : "/likes/lDelete",
					method : 'post',
					contentType : 'application/x-www-form-urlencoded',
					data : {userId:userId, targetNo:targetNo, category:category},
					beforeSend : function(xhr)
	                {
	    				xhr.setRequestHeader(header, token);
	                },
					success : function(data) {
						//alert('좋아요 취소 완료');
					},
					fail : function(result) {
						alert('필수항목을 입력해주세요')
					}
				})
	     }
	 })
	 
	   //신고부분
	   //신고 모달창 띄우기
	   $('.punishModalUp').on('click', function() {
		   console.log('클릭');
		   $("#punishFrm").show();
	   })
	   
	   //모달창에서 취소를 눌렀을 경우
	   $("#cancel").on('click', function() {
			$(this).parent().parent().parent().hide();
		});
	   
	   //모달창에서 신고를 눌렀을 경우
	   $("#punish").on('click', function() {
		   let targetId = '[[${mcSelect.userId}]]';
		   let targetCat = 'T06';
		   let banCntn = $("#banCntn").val();
		   let userId = '[[${session.member.userId}]]';
		   
		    $.ajax({
					url : "/punishInsert",
					method : 'post',
					contentType : 'application/x-www-form-urlencoded',
					data : {userId:userId, targetId:targetId, banCntn:banCntn, targetCat:targetCat},
					beforeSend : function(xhr)
	                {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
	    				xhr.setRequestHeader(header, token);
	                },
					success : function(data) {
						alert('신고되었습니다.');
						$("#punishFrm").hide();
					},
					fail : function(result) {
						console.log(result)
					}
				})
	   })
	   
	   //후기부분
	   //후기 모달창 띄우기
	   $('.reviewModalUp').on('click', function() {
		   console.log('클릭');
		   $("#reviewFrm").show();
	   })
	   
	   //클릭한 별점 수 저장
	   let stars = 0;
	   $(".label_star").on('click', function() {
		   stars = $(this).text();		   
	   })

	   //모달창에서 후기등록 버튼을 눌렀을 경우
	   $("#review").on('click', function() {
		   let reviewTgt = $("#reviewTgt").val();
		   let category = 'T06';
		   let reviewCntn = $("#reviewCntn").val();
		   let userId = '[[${session.member.userId}]]';
		   let star = stars;
		   
		    $.ajax({
					url : "/review/reviewInsert",
					method : 'post',
					contentType : 'application/x-www-form-urlencoded',
					data : {userId:userId, reviewTgt:reviewTgt, star:star, reviewCntn:reviewCntn, category:category},
					beforeSend : function(xhr)
	                {  
	    				xhr.setRequestHeader(header, token);
	                },
					success : function(data) {
						alert('후기가 등록되었습니다.');
						$("#reviewFrm").hide();
					},
					fail : function(result) {
						console.log(result)
					}
				})
	   })
	   
	   let cId = '';
	   let fromId = '[[${session.member.userId}]]';
	   let stompClient = null;
	   //채팅버튼을 눌렀을 때
		$(".chattingUp").on("click", function () {
			$(".chat").toggleClass("active");
			
			let toId = $('#left').children().children('#userId').text();
			
			//채팅방 구독 생성
			function createChatRoom() {
				let chatroomDataList = new Array();
				let chatroomData1 = {
						toId : toId,
						fromId : fromId
				};
				chatroomDataList.push(chatroomData1);
				let chatroomData2 = {
						toId : fromId,
						fromId : toId
				};
				chatroomDataList.push(chatroomData2);
				
				console.log(JSON.stringify(chatroomDataList));
				
				$.ajax({
		   			url : '/chatInsert',
		   			method : 'post',
		   			data : JSON.stringify(chatroomDataList),
		   			contentType : "application/json; charset=UTF-8",
		   			beforeSend : function(xhr)
		            {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
						xhr.setRequestHeader(header, token);
		            }
		   		}).then(res => {
		   			cId = res;
		   			console.log("cid", cId);
					connect();
		   		})
			}
		   		
		   	function connect() {
		   			//구독
		   			var socket = new SockJS('/gs-guide-websocket');
		            stompClient = Stomp.over(socket);
		            stompClient.connect({}, function (frame) {
		            console.log('Connected: ' + frame);
					
		            //방 구독하기
		            stompClient.subscribe('/topic/chat/' + cId, function (chat) {  
		            var content = JSON.parse(chat.body);
		            console.log(content);
		            //키값
		            let tag = `<li class="repaly">
                        <p>content.msgCntn</p>
                        //<span class="time">${userId}</span>
                      </li>`;
                     
		            $("#greetings").append(tag);
		           })
		       })
			}
				
			function makeList(r){
				console.log('리스트만들기')
				let list = `<a href="#" class="d-flex align-items-center">
								<div class="flex-grow-1 ms-3">
									<h3>${r.toId}</h3>
									<p>front end developer</p>
								</div>
							 </a>`;
				return list;
			}
			
			//채팅화면이 나타난다.
			if ($(".chat").hasClass("active")) {
				console.log(fromId);
				$.ajax({
					url : '/chatSelect',
					method : 'post',
		   			data : JSON.stringify({fromId:fromId}),
		   			contentType : "application/json; charset=UTF-8",
		   			beforeSend : function(xhr)
		            {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
						xhr.setRequestHeader(header, token);
		            }
		   		}).then(res => {
		   			console.log(res);
		   			console.log(res.length);
		   			if(res.length >= 1){
		   				for(r of res){
		   					console.log('r' + r);
		   					$(".chat-list").append(makeList(r));
		   				}
		   			} else {
		   				createChatRoom();
		   			}
		   		})
				
				//createChatRoom();
				$(".chat-popup").show();

			}

			//채팅화면이 사라진다.
			if (!$(".chat").hasClass("active")) {
				$(".chat-popup").hide();
			}
			});
	   
	   $("#send").click(function sendMessage() {
			stompClient.send("/app/chat", {}, JSON.stringify({
				 chaId : cId,
				 fromId : fromId,
				 msgCntn : $("#name").val()
			}));
			
			$("name").val("");

		});
   </script>
</div>
</html>