<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eventi.left.member.mapper.MemberMapper">

	<!-- 아이디 중복체크 -->
	<select id="IdCheck" resultType="int">
		SELECT COUNT(*) 
		FROM MEMBERS 
		WHERE USER_ID = #{inputId}
	</select>
	
	<!-- 회원가입 -->
	<insert id="insertMember">
		INSERT INTO MEMBERS (USER_ID, 
							 USER_PASSWORD, 
							 USER_EMAIL, 
							 USER_NAME,
							 USER_MESSAGING, 
							 USER_GRADE, 
							 USER_REGDATE)
		VALUES(#{userId}, 
			   #{userPassword}, 
			   #{userEmail}, 
			   #{name}, 
			   #{userMessaging},
			   #{auth}, 
			   SYSDATE)
	</insert>
	
	<!-- 업체 회원가입 -->
	<insert id="insertBusi">
		INSERT INTO BUSI_MEMBER (USER_ID,
								 BUSI_NUM,
								 BUSI_TITLE,
								 BUSI_TYPE,
								 BUSI_AREA,
								 BUSI_STYLE)
		VALUES(#{userId}, 
			   #{busiNum}, 
			   #{busiTitle}, 
			   #{busiType}, 
			   #{busiArea},
			   #{busiStyle})
	</insert>

	<!-- 자격증 승인신청 -->
	<insert id="insertCrtf">
		INSERT INTO CERTIFICATE
		VALUES('CE'||CERTIFICATE_ID.NEXTVAL, 
			   #{userId}, 
			   #{certName}, 
			   #{certNum},
			   'N',
			   #{certType})
	</insert>

	<!-- 회원 단건 조회 -->
	<select id="getMember" resultType="MemberVO">
		SELECT 	USER_ID,
				USER_PASSWORD,
				USER_EMAIL,
				USER_NAME name,
				USER_PHONE,
				USER_MESSAGING,
				USER_GRADE auth,
				RPRT,
				DEPOTR,
				BANK,
				ACCNT,
				USER_REGDATE 
		FROM MEMBERS 
		WHERE USER_ID = #{userId}
	</select>
	
	<!-- 아이디 찾기 -->
	<select id="findId" resultType="String">
		SELECT USER_ID
		FROM MEMBERS
		WHERE USER_NAME = #{name}
		AND USER_EMAIL = #{email}
	</select>
	
	<!-- 비밀번호 찾기 -->
	<select id="findPwCheck" resultType="int">
		SELECT COUNT(*) 
		FROM MEMBERS 
		WHERE USER_ID = #{id}
		AND USER_NAME = #{name}
		AND USER_EMAIL = #{email}
	</select>
	
	<!-- 비밀번호 변경 -->
	<update id="updatePw">
	UPDATE MEMBERS
	SET USER_PASSWORD = #{userPassword}
	WHERE USER_ID = #{userId}
	</update>
	
	<select id="getCountry" resultType="CodeVO">
	SELECT CODE_ID, CODE_NAME
	FROM MNCODE 
	WHERE CL_ID = 'A'
	</select>
	
	<select id="getType" resultType="CodeVO">
	SELECT CODE_ID, CODE_NAME
	FROM MNCODE 
	WHERE CL_ID = 'E'
	</select>
</mapper>