<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eventi.left.job.mapper.JobBoardMapper">
	<!-- 구인게시글 검색(이걸하는 이유... 데이터 용량때문...) --> 
	<sql id="jSelect">
	<where>
		<!-- 검색창 입력 시 -->
		<if test="title !=null and title != ''">
			( TITLE LIKE '%${title}%' OR JOB_CNTN LIKE '%${title}%' ) <!-- where or를 ()로 묶어야 밑으로 안감 and가 먼저  -->
		</if>
		<!-- option 선택 시-->
		<if test="eType !=null and eType != ''">
			AND E_TYPE = #{eType}
		</if>
		</where>
	</sql>	
	
	<!-- 구인게시글 전체조회 -->
	<select id="getJobList" resultType="com.eventi.left.job.service.JobBoardVO">
		SELECT JOB_NO,
				TITLE,
				JOB_CNTN,
				PAY,
				LOC,
				code_select(E_TYPE) E_TYPE,
				W_SDAY,
				W_EDAY,
				W_HOUR,
				QUALIFICATION,
				PREFERENCE,
				IMG,
				USER_ID,
				INTEREST	
		FROM (SELECT ROWNUM RN, A.* FROM (
			SELECT *
			FROM JOB_BOARD
	  	<![CDATA[
			) A WHERE ROWNUM <= #{last}) WHERE RN >= #{first}
		]]>
		<include refid="jSelect" />
	</select>
	
	<!-- 게시글 개수 -->
	<select id="count" resultType="int">
		SELECT COUNT(*)
		FROM JOB_BOARD
	</select>
	
	<!-- 구인게시글 단건조회 -->
	<select id="getJob" resultType="com.eventi.left.job.service.JobBoardVO">
		SELECT *
		FROM JOB_BOARD
		WHERE JOB_NO  = #{jobNo}
	</select>
	
	<!-- 게시글 수정 jobno, userid, interest 제외-->
	<update id="getJobUpdate" parameterType="com.eventi.left.job.service.JobBoardVO">
		UPDATE JOB_BOARD
		SET 
		TITLE = #{title},
		JOB_CNTN = #{jobCntn},
		PAY = #{pay},
		LOC = #{loc},
		E_TYPE = #{eType},
		W_SDAY = #{wSday},
		W_EDAY = #{wEday},
		W_HOUR = #{wHour},
		QUALIFICATION = #{qualification},
		PREFERENCE = #{preference},
		IMG = #{img}	
		WHERE JOB_NO=#{jobNo}
	</update>
	
	<!-- 게시글 등록 -->
	<insert id="jobInsert">
		INSERT INTO JOB_BOARD
		(JOB_NO, TITLE, JOB_CNTN, PAY, LOC, E_TYPE, W_SDAY, W_EDAY, W_HOUR, QUALIFICATION, PREFERENCE, IMG, USER_ID) <!-- DB -->
		VALUES('JB'|| JOB_BOARD_SEQ.NEXTVAL, #{title}, #{jobCntn}, 
				#{pay}, #{loc}, #{eType}, #{wSday}, #{wEday}, #{wHour}, #{qualification}, #{preference}, #{img}, #{userId}) <!-- VO -->
	</insert>
	
	<!-- 게시글 삭제 -->
	<delete id="jobDelete">
		DELETE FROM JOB_BOARD
		WHERE JOB_NO=#{jobNo}
	</delete>
</mapper>