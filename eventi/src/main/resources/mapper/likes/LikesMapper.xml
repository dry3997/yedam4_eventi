<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eventi.left.likes.mapper.LikesMapper">
	<!-- 삭제조건에 userId가 있을 경우 -->
	<sql id="userIdSelect">
		<if test="userId !=null and userId != ''">
			AND USER_ID = #{userId}
		</if>
	</sql>

	<!-- 좋아요 전체 조회 -->
	<!-- join map으로 받을경우, 컬럼명 대문자 인식!! -->
	<select id="userlikeList" resultType="map">
		SELECT l.*,c.*,f.sev_nm IMG
      	FROM likes l JOIN CONTEST c
                       ON C.C_NO = L.TARGET_NO
                     JOIN FILES F
                       ON L.TARGET_NO = F.TARGET_ID
		and l.USER_ID = #{userId}
	</select>

	<select id="likeList" resultType="LikesVO">
		SELECT * FROM likes
	</select>
	
	<!-- 로그인회원의 게시글 좋아요 여부 확인 -->
	<select id="getLike" resultType="LikesVO">
		SELECT *
		FROM LIKES
		WHERE USER_ID = #{userId}
		AND TARGET_NO = #{targetNo}
	</select>
	
	<!-- 해당게시글 좋아요 건수 조회 -->
	<select id="countLike" resultType="int">
		SELECT COUNT(*) 
		FROM LIKES 
		WHERE TARGET_NO=#{targetNo}
	</select>
	
	<!-- 로그인회원의 좋아요 등록 -->
	<insert id="likeInsert">
		INSERT INTO LIKES
		VALUES('LI'||LIKENO_SEQ.NEXTVAL,
		#{userId}, #{targetNo}, #{category})
	</insert>

	<!-- 로그인회원의 좋아요 취소 -->
	<delete id="likeDelete">
		DELETE FROM LIKESㄴ
		WHERE TARGET_NO = #{targetNo}
		AND CATEGORY = #{category}
		<include refid="userIdSelect" />
	</delete>
</mapper>